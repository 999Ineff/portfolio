---
import BaseLayout from './BaseLayout.astro';
import SectionLabel from '../components/SectionLabel.astro';

interface Props {
  title: string;
  date: string;
  category: string;
  categoryColor: 'gold' | 'cyan' | 'green';
  excerpt: string;
  tags?: string[];
  linkedIn?: boolean;
  linkedInUrl?: string;
  prevPost?: { slug: string; title: string } | null;
  nextPost?: { slug: string; title: string } | null;
}

const {
  title,
  date,
  category,
  categoryColor,
  excerpt,
  tags = [],
  linkedIn,
  linkedInUrl,
  prevPost,
  nextPost,
} = Astro.props;

function formatDate(dateStr: string) {
  return new Date(dateStr).toLocaleDateString('en-US', {
    month: 'long',
    day: 'numeric',
    year: 'numeric',
  });
}
---

<BaseLayout title={title} description={excerpt}>
  <article class="blog-post">
    <header class="post-header section-lg">
      <div class="container post-header-inner">
        <a href="/blog" class="back-link reveal">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M10 12L6 8l4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to Blog
        </a>

        <div class="post-meta reveal" data-delay="0.05">
          <span class={`tag tag-${categoryColor === 'gold' ? '' : categoryColor}`}>
            {category}
          </span>
          <span class="post-date font-mono">{formatDate(date)}</span>
        </div>

        <h1 class="post-title reveal" data-delay="0.1" transition:name={`blog-title-${Astro.url.pathname.split('/').pop()}`}>
          {title}
        </h1>

        {linkedIn && (
          <p class="post-source reveal" data-delay="0.15">
            <span class="source-dot"></span>
            Originally posted on
            {linkedInUrl ? (
              <a href={linkedInUrl} target="_blank" rel="noopener" class="linkedin-link">LinkedIn</a>
            ) : (
              <a href="https://www.linkedin.com/in/luisaviles1" target="_blank" rel="noopener" class="linkedin-link">LinkedIn</a>
            )}
          </p>
        )}
      </div>
    </header>

    <div class="post-body">
      <div class="container-reading">
        <div class="prose reveal" data-delay="0.2">
          <slot />
        </div>

        {tags.length > 0 && (
          <div class="post-tags reveal" data-delay="0.25">
            {tags.map(tag => (
              <span class="post-tag font-mono">#{tag}</span>
            ))}
          </div>
        )}
      </div>
    </div>

    <nav class="post-nav">
      <div class="container-reading post-nav-inner">
        {prevPost ? (
          <a href={`/blog/${prevPost.slug}`} class="post-nav-link post-nav-prev">
            <span class="post-nav-label font-mono">Previous</span>
            <span class="post-nav-title">{prevPost.title}</span>
          </a>
        ) : <div />}
        {nextPost ? (
          <a href={`/blog/${nextPost.slug}`} class="post-nav-link post-nav-next">
            <span class="post-nav-label font-mono">Next</span>
            <span class="post-nav-title">{nextPost.title}</span>
          </a>
        ) : <div />}
      </div>
    </nav>
  </article>
</BaseLayout>

<style>
  .blog-post {
    min-height: 100vh;
  }

  .post-header {
    min-height: auto;
    padding-top: calc(var(--nav-height) + var(--space-xl));
    padding-bottom: var(--space-lg);
  }

  .post-header-inner {
    max-width: 720px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--text-xs);
    color: var(--text-dim);
    letter-spacing: 0.05em;
    transition: color var(--duration-fast);
    margin-bottom: 0.5rem;
  }

  .back-link:hover {
    color: var(--gold);
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .post-date {
    font-size: var(--text-xs);
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }

  .post-title {
    font-size: var(--text-3xl);
    font-weight: 800;
    line-height: 1.15;
    letter-spacing: -0.01em;
  }

  .post-source {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: var(--text-sm);
    color: var(--text-dim);
  }

  .source-dot {
    width: 6px;
    height: 6px;
    background: #0a66c2;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .linkedin-link {
    color: var(--gold);
    text-decoration: underline;
    text-underline-offset: 3px;
    transition: color var(--duration-fast);
  }

  .linkedin-link:hover {
    color: #ffcf5e;
  }

  /* Post Body */
  .post-body {
    padding-bottom: var(--space-xl);
  }

  .container-reading {
    max-width: 720px;
    margin: 0 auto;
    padding: 0 var(--space-md);
  }

  /* Prose Typography */
  .prose {
    font-size: var(--text-base);
    color: var(--text-secondary);
    line-height: 1.8;
  }

  .prose :global(h2) {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text);
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }

  .prose :global(h3) {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--text);
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .prose :global(p) {
    margin-bottom: 1.25rem;
  }

  .prose :global(strong) {
    color: var(--text);
    font-weight: 600;
  }

  .prose :global(em) {
    color: var(--text-dim);
    font-style: italic;
  }

  .prose :global(a) {
    color: var(--gold);
    text-decoration: underline;
    text-underline-offset: 3px;
    transition: color var(--duration-fast);
  }

  .prose :global(a:hover) {
    color: #ffcf5e;
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }

  .prose :global(ul) {
    list-style: disc;
  }

  .prose :global(ol) {
    list-style: decimal;
  }

  .prose :global(li) {
    margin-bottom: 0.5rem;
    line-height: 1.7;
  }

  .prose :global(li strong) {
    color: var(--gold);
  }

  .prose :global(blockquote) {
    border-left: 2px solid var(--gold);
    padding-left: 1.25rem;
    margin: 1.5rem 0;
    color: var(--text-dim);
    font-style: italic;
  }

  .prose :global(code) {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85em;
    background: var(--bg-elevated);
    padding: 0.15rem 0.4rem;
    border-radius: 3px;
    border: 1px solid var(--border);
    color: var(--cyan);
  }

  .prose :global(pre) {
    background: var(--bg-card);
    border: 1px solid var(--border);
    padding: 1.25rem;
    margin: 1.5rem 0;
    overflow-x: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    line-height: 1.6;
  }

  .prose :global(pre code) {
    background: none;
    border: none;
    padding: 0;
    color: var(--text-secondary);
  }

  .prose :global(hr) {
    border: none;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border-hover), transparent);
    margin: 2rem 0;
  }

  /* Tags */
  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 2.5rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border);
  }

  .post-tag {
    font-size: var(--text-xs);
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }

  /* Post Navigation */
  .post-nav {
    border-top: 1px solid var(--border);
    padding: var(--space-md) 0;
  }

  .post-nav-inner {
    display: flex;
    justify-content: space-between;
    gap: var(--space-md);
  }

  .post-nav-link {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    padding: 1rem;
    border: 1px solid var(--border);
    background: var(--bg-card);
    transition: all var(--duration-fast) var(--ease-out);
    max-width: 48%;
  }

  .post-nav-link:hover {
    border-color: var(--border-hover);
    transform: translateY(-2px);
  }

  .post-nav-next {
    text-align: right;
    margin-left: auto;
  }

  .post-nav-label {
    font-size: var(--text-xs);
    color: var(--text-muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .post-nav-title {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text);
    line-height: 1.4;
  }

  /* Click-outside areas */
  .blog-post {
    cursor: pointer;
  }

  .post-header-inner,
  .container-reading,
  .post-nav-inner {
    cursor: auto;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .post-header {
      padding-top: calc(var(--nav-height) + var(--space-lg));
    }

    .post-title {
      font-size: var(--text-2xl);
    }

    .post-nav-inner {
      flex-direction: column;
    }

    .post-nav-link {
      max-width: 100%;
    }

    .post-nav-next {
      text-align: left;
    }
  }
</style>

<script>
  function initBlogClickOutside() {
    const article = document.querySelector('.blog-post');
    if (!article) return;

    const contentZones = ['.post-header-inner', '.container-reading', '.post-nav-inner', 'a', 'button'];

    article.addEventListener('click', (e) => {
      const target = e.target as HTMLElement;
      // Only navigate if clicking the empty background areas, not content
      const isContent = contentZones.some(sel => target.closest(sel));
      if (!isContent) {
        window.location.href = '/blog';
      }
    });
  }

  initBlogClickOutside();
  document.addEventListener('astro:after-swap', initBlogClickOutside);
</script>
